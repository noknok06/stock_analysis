<!-- templates/notebooks/detail.html -->
{% extends 'base.html' %}

{% block title %}{{ notebook.title }} - 株式分析記録アプリ{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-4 space-y-6">
    <!-- ヘッダー -->
    <div class="flex items-center gap-4">
        <a href="{% url 'dashboard' %}" class="tw-btn-outline tw-btn-sm">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            戻る
        </a>
        <div class="flex-1">
            <h1 class="text-2xl font-bold">{{ notebook.title }}</h1>
            <p class="text-gray-600">{{ notebook.subtitle }}</p>
        </div>
        <a href="{% url 'notebook_edit' notebook.pk %}" class="tw-btn-outline tw-btn-sm">
            <i data-lucide="edit" class="w-4 h-4"></i>
            編集
        </a>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- メインコンテンツ -->
        <div class="lg:col-span-2 space-y-6">
            <!-- 投資目標 -->
            <div class="tw-card">
                <div class="tw-card-header">
                    <h2 class="tw-card-title flex items-center gap-2">
                        <i data-lucide="target" class="w-5 h-5"></i>
                        投資目標
                    </h2>
                </div>
                <div class="tw-card-content space-y-4">
                    {% if notebook.investment_goal %}
                        <div>
                            <label class="text-sm font-medium text-gray-700">投資理由・戦略</label>
                            <p class="mt-1 text-gray-900">{{ notebook.investment_goal }}</p>
                        </div>
                    {% endif %}
                    <div class="grid grid-cols-2 gap-4">
                        {% if notebook.current_price %}
                            <div>
                                <label class="text-sm font-medium text-gray-700">現在価格</label>
                                <p class="text-lg font-semibold text-gray-900">¥{{ notebook.current_price|floatformat:0 }}</p>
                            </div>
                        {% endif %}
                        {% if notebook.target_price %}
                            <div>
                                <label class="text-sm font-medium text-gray-700">目標価格</label>
                                <p class="text-lg font-semibold text-green-600">¥{{ notebook.target_price|floatformat:0 }}</p>
                            </div>
                        {% endif %}
                    </div>
                    {% if notebook.risk_factors %}
                        <div>
                            <label class="text-sm font-medium text-gray-700">リスク要因</label>
                            <p class="mt-1 text-red-600 flex items-start gap-2">
                                <i data-lucide="alert-circle" class="w-4 h-4 mt-0.5 flex-shrink-0"></i>
                                {{ notebook.risk_factors }}
                            </p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- 記録エントリー -->
            <div class="tw-card">
                <div class="tw-card-header">
                    <div class="flex items-center justify-between">
                        <h2 class="tw-card-title">記録エントリー</h2>
                        <a href="{% url 'entry_create' notebook.pk %}" class="tw-btn-primary tw-btn-sm">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            新規記録
                        </a>
                    </div>
                </div>
                <div class="tw-card-content">
                    {% if entries_page.object_list %}
                        <div class="space-y-4">
                            {% for entry in entries_page.object_list %}
                            <div class="border rounded-lg p-4">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="tw-badge-default">{{ entry.get_entry_type_display }}</span>
                                        <h3 class="font-semibold">{{ entry.title|default:"エントリー" }}</h3>
                                    </div>
                                    <span class="text-xs text-gray-500 flex items-center gap-1">
                                        <i data-lucide="calendar" class="w-3 h-3"></i>
                                        {{ entry.created_at|date:"Y年m月d日" }}
                                    </span>
                                </div>
                                <p class="text-gray-700 whitespace-pre-line mb-3">{{ entry.content }}</p>
                                {% if entry.tags.all %}
                                    <div class="flex flex-wrap gap-1">
                                        {% for tag in entry.tags.all %}
                                            <span class="tw-badge-outline text-xs">#{{ tag.name }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- ページネーション -->
                        {% if entries_page.has_other_pages %}
                            <div class="flex justify-center mt-6">
                                <nav class="flex items-center gap-2">
                                    {% if entries_page.has_previous %}
                                        <a href="?page={{ entries_page.previous_page_number }}" class="tw-btn-outline tw-btn-sm">前へ</a>
                                    {% endif %}
                                    <span class="px-3 py-1 text-sm">
                                        {{ entries_page.number }} / {{ entries_page.paginator.num_pages }}
                                    </span>
                                    {% if entries_page.has_next %}
                                        <a href="?page={{ entries_page.next_page_number }}" class="tw-btn-outline tw-btn-sm">次へ</a>
                                    {% endif %}
                                </nav>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <i data-lucide="book-open" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                            <p>まだ記録がありません</p>
                            <p class="text-sm">「新規記録」ボタンから最初の分析を記録しましょう</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- サイドバー -->
        <div class="space-y-6">
            <!-- 株価情報 -->
            <div class="tw-card">
                <div class="tw-card-header">
                    <h3 class="tw-card-title flex items-center gap-2">
                        <i data-lucide="trending-up" class="w-5 h-5"></i>
                        株価情報
                    </h3>
                </div>
                <div class="tw-card-content space-y-3">
                    {% if notebook.current_price %}
                        <div class="text-center">
                            <div class="text-2xl font-bold">¥{{ notebook.current_price|floatformat:0 }}</div>
                            <div class="text-green-600">+45 (+1.6%)</div>
                        </div>
                    {% endif %}
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span class="text-gray-600">PER:</span>
                            <span class="font-semibold ml-1">12.5</span>
                        </div>
                        <div>
                            <span class="text-gray-600">PBR:</span>
                            <span class="font-semibold ml-1">1.2</span>
                        </div>
                        <div>
                            <span class="text-gray-600">配当利回り:</span>
                            <span class="font-semibold ml-1">8.8%</span>
                        </div>
                        <div>
                            <span class="text-gray-600">ROE:</span>
                            <span class="font-semibold ml-1">9.2%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- タグ -->
            <div class="tw-card">
                <div class="tw-card-header">
                    <h3 class="tw-card-title flex items-center gap-2">
                        <i data-lucide="tag" class="w-5 h-5"></i>
                        タグ
                    </h3>
                </div>
                <div class="tw-card-content">
                    <div class="flex flex-wrap gap-2">
                        {% for tag in notebook.tags.all %}
                            <span class="tw-badge-secondary">#{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- クイック計算 -->
            <div class="tw-card">
                <div class="tw-card-header">
                    <h3 class="tw-card-title flex items-center gap-2">
                        <i data-lucide="calculator" class="w-5 h-5"></i>
                        クイック計算
                    </h3>
                </div>
                <div class="tw-card-content space-y-3">
                    <div>
                        <label class="text-sm text-gray-600">投資金額</label>
                        <input type="number" class="tw-input" placeholder="100000" id="investment-amount">
                    </div>
                    <div>
                        <label class="text-sm text-gray-600">購入可能株数</label>
                        <div class="text-lg font-semibold" id="stock-count">35株</div>
                    </div>
                    <div>
                        <label class="text-sm text-gray-600">年間配当予想</label>
                        <div class="text-lg font-semibold text-green-600" id="dividend-estimate">¥8,750</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}